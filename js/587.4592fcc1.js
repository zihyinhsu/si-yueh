"use strict";(self["webpackChunksi_yueh"]=self["webpackChunksi_yueh"]||[]).push([[587],{3587:function(e,t,a){a.r(t),a.d(t,{default:function(){return oe}});var l=a(6252),o=a(3577),s=a(9963),i=a(9163);const d=(0,l._)("img",{src:i,alt:"Loading"},null,-1),n={class:"d-flex justify-content-between align-items-center mb-4"},p=(0,l._)("div",{class:"header d-flex align-items-center"},[(0,l._)("h2",{class:"category bg-white text-primaryDark fw-bold fs-3 me-4 p-2"},"# 優惠券管理")],-1),c=(0,l._)("i",{class:"fa-solid fa-book-medical me-3"},null,-1),r=(0,l.Uk)("新增優惠券 "),u=[c,r],h={class:"table caption-top table-hover text-primaryDark"},m=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",{class:"fw-bold",scope:"col"},"名稱"),(0,l._)("th",{scope:"col"},"折扣百分比"),(0,l._)("th",{scope:"col"},"到期日"),(0,l._)("th",{scope:"col"},"是否啟用"),(0,l._)("th",{scope:"col"},"編輯/刪除")])],-1),_={class:"ps-5"},b={class:"switch"},f=["onUpdate:modelValue","onChange"],w=(0,l._)("span",{class:"slider"},null,-1),g={class:"d-flex"},v=["onClick"],M=(0,l._)("i",{class:"fa-solid fa-pencil cursor-pointer text-primary fs-4 me-6"},null,-1),C=[M],y=["onClick"],x=(0,l._)("i",{class:"fa-solid fa-trash cursor-pointer text-primary fs-4"},null,-1),D=[x];function k(e,t,a,i,c,r){const M=(0,l.up)("LoadingView"),x=(0,l.up)("CouponModal"),k=(0,l.up)("DelModal");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(M,{class:"loading",active:c.isLoading},{default:(0,l.w5)((()=>[d])),_:1},8,["active"]),(0,l._)("div",n,[p,(0,l._)("div",{class:"btn btn-primary text-white",onClick:t[0]||(t[0]=e=>r.openModal("isCreateNew"))},u)]),(0,l._)("table",h,[m,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(c.coupons,(t=>((0,l.wg)(),(0,l.iD)("tr",{key:t.id},[(0,l._)("td",null,(0,o.zw)(t.title),1),(0,l._)("td",null,(0,o.zw)(t.percent)+" %",1),(0,l._)("td",null,(0,o.zw)(e.$filters.date(t.due_date)),1),(0,l._)("td",_,[(0,l._)("label",b,[(0,l.wy)((0,l._)("input",{type:"checkbox","onUpdate:modelValue":e=>t.is_enabled=e,onChange:e=>r.updateCoupon(t,!1),"true-value":1,"false-value":0},null,40,f),[[s.e8,t.is_enabled]]),w])]),(0,l._)("td",null,[(0,l._)("div",g,[(0,l._)("div",{class:"editBtn d-flex align-items-center",onClick:e=>r.openModal("edit",t)},C,8,v),(0,l._)("div",{class:"delBtn d-flex align-items-center",onClick:e=>r.openModal("delete",t)},D,8,y)])])])))),128))])]),(0,l.Wm)(x,{ref:"couponModal",temp:c.temp,isCreateNew:c.isCreateNew,onUpdateCoupons:r.updateCoupon},null,8,["temp","isCreateNew","onUpdateCoupons"]),(0,l.Wm)(k,{ref:"delModal",temp:c.temp,onDelItem:r.delCouponItem},null,8,["temp","onDelItem"])],64)}var L=a(8262),$=a(6294);const N={class:"modal fade",ref:"modal",tabindex:"-1"},U={class:"modal-dialog modal-dialog-centered modal"},z={class:"modal-content background-transparent"},V=(0,l._)("div",{class:"modal-header bg-primary text-center p-3"},[(0,l._)("h4",{class:"modal-title text-white"},"新增優惠券")],-1),I={class:"modal-body bg-white p-6"},Z={class:"row"},W={class:"mb-3 col"},B=(0,l._)("label",{for:"title",class:"form-label"},"名稱",-1),H={class:"mb-3 col"},S=(0,l._)("label",{for:"code",class:"form-label"},"優惠碼",-1),T={class:"row"},Y={class:"mb-3 col"},j=(0,l._)("label",{for:"percent",class:"form-label"},"折扣百分比",-1),K={class:"mb-3 col"},O=(0,l._)("label",{for:"due_date",class:"form-label"},"到期日",-1),q=(0,l._)("p",{class:"fw-bold fs-4 mb-2"},"是否啟用",-1),A={class:"switch"},E=(0,l._)("span",{class:"slider"},null,-1),F={class:"modal-footer bg-white w-100"},G=(0,l._)("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"},"取消",-1);function J(e,t,a,i,d,n){return(0,l.wg)(),(0,l.iD)("div",N,[(0,l._)("div",U,[(0,l._)("div",z,[V,(0,l._)("div",I,[(0,l._)("div",Z,[(0,l._)("div",W,[B,(0,l.wy)((0,l._)("input",{id:"title",type:"text",min:"0",class:"form-control",placeholder:"請輸入名稱","onUpdate:modelValue":t[0]||(t[0]=t=>e.tempModalData.title=t)},null,512),[[s.nr,e.tempModalData.title,void 0,{trim:!0}]])]),(0,l._)("div",H,[S,(0,l.wy)((0,l._)("input",{id:"code",type:"text",min:"0",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[1]||(t[1]=t=>e.tempModalData.code=t)},null,512),[[s.nr,e.tempModalData.code,void 0,{trim:!0}]])])]),(0,l._)("div",T,[(0,l._)("div",Y,[j,(0,l.wy)((0,l._)("input",{id:"percent",type:"text",min:"0",class:"form-control",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[2]||(t[2]=t=>e.tempModalData.percent=t)},null,512),[[s.nr,e.tempModalData.percent,void 0,{number:!0}]])]),(0,l._)("div",K,[O,(0,l.wy)((0,l._)("input",{id:"due_date",type:"date",min:"0",class:"form-control",placeholder:"到期日","onUpdate:modelValue":t[3]||(t[3]=e=>d.due_date=e)},null,512),[[s.nr,d.due_date]])])]),q,(0,l._)("label",A,[(0,l.wy)((0,l._)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=t=>e.tempModalData.is_enabled=t),"true-value":1,"false-value":0},null,512),[[s.e8,e.tempModalData.is_enabled]]),E])]),(0,l._)("div",F,[G,(0,l._)("button",{type:"button",class:"btn btn-primary text-white",onClick:t[5]||(t[5]=t=>e.$emit("update-Coupons",e.tempModalData,a.isCreateNew))},(0,o.zw)(a.isCreateNew?"確定新增":"確定修改"),1)])])])],512)}var P=a(1339),Q={mixins:[P.Z],props:["isCreateNew"],data(){return{due_date:""}},watch:{temp:{handler(){const e=new Date(1e3*this.tempModalData.due_date).toISOString().split("T");this.due_date=e[0]},deep:!0},due_date(){this.tempModalData.due_date=Math.floor(new Date(this.due_date)/1e3)}}},R=a(3744);const X=(0,R.Z)(Q,[["render",J]]);var ee=X,te=a(6354),ae={data(){return{temp:{},coupons:{},isCreateNew:!0,isLoading:!1}},components:{CouponModal:ee,DelModal:te.Z},methods:{...(0,L.nv)($.Z,["pushMsg"]),getCoupons(){this.isLoading=!0,this.$http.get("https://vue3-course-api.hexschool.io/v2/api/zy123/admin/coupons").then((e=>{this.coupons=e.data.coupons,this.isLoading=!1})).catch((()=>{this.isLoading=!1}))},openModal(e,t){"isCreateNew"===e?(this.temp={due_date:(new Date).getTime()/1e3,is_enabled:0},this.isCreateNew=!0,this.$refs.couponModal.openModal()):"edit"===e?(this.temp={...t},this.isCreateNew=!1,this.$refs.couponModal.openModal()):"delete"===e&&(this.temp={...t},this.$refs.delModal.openModal())},updateCoupon(e,t){let a="https://vue3-course-api.hexschool.io/v2/api/zy123/admin/coupon",l="post";!1===t&&(l="put",a=`https://vue3-course-api.hexschool.io/v2/api/zy123/admin/coupon/${e.id}`),this.isLoading=!0,this.$http[l](a,{data:e}).then((e=>{this.isLoading=!1,this.pushMsg(e,"更新","已成功更新優惠券"),this.$refs.couponModal.hideModal(),this.getCoupons()})).catch((()=>{this.isLoading=!1,this.pushMsg(!1,"更新","更新優惠券失敗")}))},delCouponItem(e){this.isLoading=!0,this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/zy123/admin/coupon/${e.id}`).then((e=>{this.pushMsg(e,"更新","已成功刪除優惠券"),this.isLoading=!1,this.$refs.delModal.hideModal(),this.getCoupons()})).catch((()=>{this.pushMsg(!1,"更新","刪除優惠券失敗"),this.isLoading=!1}))}},mounted(){this.getCoupons()}};const le=(0,R.Z)(ae,[["render",k]]);var oe=le}}]);
//# sourceMappingURL=587.4592fcc1.js.map